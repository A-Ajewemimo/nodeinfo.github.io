"use strict";
var __extends = (this && this.__extends) || (function() {
    var extendStatics = function(d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({
                    __proto__: []
                }
                instanceof Array && function(d, b) {
                    d.__proto__ = b;
                }) ||
            function(d, b) {
                for (var p in b)
                    if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
            };
        return extendStatics(d, b);
    };
    return function(d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);

        function __() {
            this.constructor = d;
        }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function() {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s)
                if (Object.prototype.hasOwnProperty.call(s, p))
                    t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function(thisArg, _arguments, P, generator) {
    function adopt(value) {
        return value instanceof P ? value : new P(function(resolve) {
            resolve(value);
        });
    }
    return new(P || (P = Promise))(function(resolve, reject) {
        function fulfilled(value) {
            try {
                step(generator.next(value));
            } catch (e) {
                reject(e);
            }
        }

        function rejected(value) {
            try {
                step(generator["throw"](value));
            } catch (e) {
                reject(e);
            }
        }

        function step(result) {
            result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
        }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function(thisArg, body) {
    var _ = {
            label: 0,
            sent: function() {
                if (t[0] & 1) throw t[1];
                return t[1];
            },
            trys: [],
            ops: []
        },
        f, y, t, g;
    return g = {
        next: verb(0),
        "throw": verb(1),
        "return": verb(2)
    }, typeof Symbol === "function" && (g[Symbol.iterator] = function() {
        return this;
    }), g;

    function verb(n) {
        return function(v) {
            return step([n, v]);
        };
    }

    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0:
                case 1:
                    t = op;
                    break;
                case 4:
                    _.label++;
                    return {
                        value: op[1],
                        done: false
                    };
                case 5:
                    _.label++;
                    y = op[1];
                    op = [0];
                    continue;
                case 7:
                    op = _.ops.pop();
                    _.trys.pop();
                    continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                        _ = 0;
                        continue;
                    }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) {
                        _.label = op[1];
                        break;
                    }
                    if (op[0] === 6 && _.label < t[1]) {
                        _.label = t[1];
                        t = op;
                        break;
                    }
                    if (t && _.label < t[2]) {
                        _.label = t[2];
                        _.ops.push(op);
                        break;
                    }
                    if (t[2]) _.ops.pop();
                    _.trys.pop();
                    continue;
            }
            op = body.call(thisArg, _);
        } catch (e) {
            op = [6, e];
            y = 0;
        } finally {
            f = t = 0;
        }
        if (op[0] & 5) throw op[1];
        return {
            value: op[0] ? op[1] : void 0,
            done: true
        };
    }
};
var __importDefault = (this && this.__importDefault) || function(mod) {
    return (mod && mod.__esModule) ? mod : {
        "default": mod
    };
};
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.WebsocketVisitorClient = void 0;
var websocket_client_core_1 = __importDefault(require("@smartsupp/websocket-client-core"));
var websocket_client_utils_1 = require("@smartsupp/websocket-client-utils");
var WebsocketVisitorClient = /** @class */ (function(_super) {
    __extends(WebsocketVisitorClient, _super);

    function WebsocketVisitorClient(options) {
        var _this = _super.call(this, options.connection) || this;
        _this.serverVersion = null;
        _this.updatedValues = {};
        _this.connectData = options.data;
        _this.identity = null; // initialized after first connect to server
        return _this;
    }
    WebsocketVisitorClient.prototype.setConnection = function(connection) {
        _super.prototype.setConnection.call(this, connection);
        connection.on('server.error', (0, websocket_client_utils_1.bound)(this, 'onServerError'));
        connection.on('account.updated', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'account.updated'));
        connection.on('agent.updated', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'agent.updated'));
        connection.on('agent.status_updated', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'agent.status_updated'));
        connection.on('agent.removed', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'agent.removed'));
        connection.on('visitor.updated', (0, websocket_client_utils_1.bound)(this, 'onVisitorUpdated'));
        connection.on('chat.updated', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.updated'));
        connection.on('chat.agent_joined', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.agent_joined'));
        connection.on('chat.agent_assigned', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.agent_assigned'));
        connection.on('chat.agent_unassigned', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.agent_unassigned'));
        connection.on('chat.agent_left', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.agent_left'));
        connection.on('chat.opened', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.opened'));
        connection.on('chat.served', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.served'));
        connection.on('chat.closed', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.closed'));
        connection.on('chat.visitor_closed', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.visitor_closed'));
        connection.on('chat.message_received', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.message_received'));
        connection.on('chat.message_updated', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.message_updated'));
        connection.on('chat.agent_typing', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.agent_typing'));
        connection.on('chat.rated', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.rated'));
        connection.on('chat.contact_read', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.contact_read'));
        connection.on('chat.deleted', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.deleted'));
        connection.on('chat.transcript_pdf', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'chat.transcript_pdf'));
        connection.on('contact.acquired', (0, websocket_client_utils_1.createEmitter)(this.emitter, 'contact.acquired'));
    };
    WebsocketVisitorClient.prototype.on = function(event, listener) {
        this.emitter.on(event, listener);
        return this;
    };
    WebsocketVisitorClient.prototype.once = function(event, listener) {
        this.emitter.once(event, listener);
        return this;
    };
    WebsocketVisitorClient.prototype.getId = function() {
        return this.identity ? this.identity.id : null;
    };
    WebsocketVisitorClient.prototype.getIdentity = function() {
        return this.identity;
    };
    WebsocketVisitorClient.prototype.connect = function() {
        return _super.prototype.connect.call(this);
    };
    WebsocketVisitorClient.prototype.disconnect = function(logout) {
        if (logout === void 0) {
            logout = false;
        }
        return __awaiter(this, void 0, void 0, function() {
            var _this = this;
            return __generator(this, function(_a) {
                switch (_a.label) {
                    case 0:
                        if (!logout) return [3 /*break*/ , 2];
                        return [4 /*yield*/ , new Promise(function(resolve, reject) {
                            _this.send('visitor.logout', {}, (0, websocket_client_utils_1.createCallback)(resolve, reject));
                        })];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        return [2 /*return*/ , _super.prototype.disconnect.call(this)];
                }
            });
        });
    };
    //
    // API methods
    //
    WebsocketVisitorClient.prototype.update = function(values) {
        if (values === void 0) {
            values = {};
        }
        this.checkServerVersion();
        for (var name_1 in values) {
            this.identity[name_1] = values[name_1];
            this.updatedValues[name_1] = values[name_1];
        }
        this.saveVisitorValues();
    };
    WebsocketVisitorClient.prototype.authenticate = function(values) {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('visitor.authenticate', {
                values: values,
            }, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.notify = function(name, value) {
        var _this = this;
        if (value === void 0) {
            value = null;
        }
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('visitor.notify', {
                name: name,
                value: value,
            }, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatRead = function() {
        this.checkServerVersion();
        this.send('chat.read', null);
    };
    WebsocketVisitorClient.prototype.chatTyping = function(is, text) {
        if (text === void 0) {
            text = null;
        }
        this.checkServerVersion();
        this.send('chat.typing', {
            typing: {
                is: is,
                text: text
            },
        });
    };
    WebsocketVisitorClient.prototype.chatMessage = function(options) {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.message', options, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatClose = function(type) {
        if (type === void 0) {
            type = null;
        }
        this.checkServerVersion();
        this.send('chat.close', {
            type: type,
        });
    };
    WebsocketVisitorClient.prototype.chatUploadInit = function() {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.upload_init', null, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatUploadFinish = function(uploadToken) {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.upload_finish', {
                uploadToken: uploadToken,
            }, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatTranscript = function(email, lang) {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.transcript', {
                email: email,
                lang: lang,
            }, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatRateInit = function() {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.rate_init', null, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatRate = function(rating) {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.rate', rating, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.chatTranscriptPdf = function() {
        var _this = this;
        this.checkServerVersion();
        return new Promise(function(resolve, reject) {
            _this.send('chat.transcript_pdf', null, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.visitorConnect = function() {
        var _this = this;
        var values = __assign({
            version: WebsocketVisitorClient.CLIENT_VERSION
        }, this.connectData);
        for (var key in this.updatedValues) {
            values[key] = this.updatedValues[key];
        }
        this.updatedValues = {};
        if (this.identity) {
            for (var key in this.identity) {
                if (!['bannedAt', 'chatId', 'status'].includes(key)) { // filter out read-only props
                    values[key] = this.identity[key];
                }
            }
        }
        this.emitter.emit('initialize', values);
        return new Promise(function(resolve, reject) {
            _this.connection.emit('visitor.connect', values, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    WebsocketVisitorClient.prototype.visitorDisconnect = function() {
        var _this = this;
        return new Promise(function(resolve, reject) {
            _this.connection.emit('visitor.disconnect', {}, (0, websocket_client_utils_1.createCallback)(resolve, reject));
        });
    };
    //
    // Event handlers
    //
    WebsocketVisitorClient.prototype.onVisitorUpdated = function(data) {
        var changes = {};
        for (var name_2 in data.changes) {
            if (WebsocketVisitorClient.identityProperties.includes(name_2)) {
                if (this.identity) {
                    this.identity[name_2] = data.changes[name_2];
                }
                changes[name_2] = data.changes[name_2];
            }
        }
        if (Object.getOwnPropertyNames(changes).length > 0) {
            this.emitter.emit('visitor.updated', changes);
        }
    };
    WebsocketVisitorClient.prototype.onServerError = function(data) {
        var err = (0, websocket_client_utils_1.createSocketError)(data);
        this.emitter.emit('error', err);
    };
    //
    // Utils, data formatting
    //
    WebsocketVisitorClient.prototype.initialize = function() {
        var _this = this;
        return this.visitorConnect().then(function(data) {
            _this.serverVersion = data.serverVersion;
            _this.identity = __assign(__assign({}, data.visitor), {
                variables: __assign({}, data.visitor.variables)
            });
            return data;
        });
    };
    WebsocketVisitorClient.prototype.saveVisitorValues = function() {
        var _this = this;
        if (!this.initialized) {
            return; // update only if initialized
        }
        setTimeout(function() {
            if (!_this.initialized || (Object.getOwnPropertyNames(_this.updatedValues).length === 0)) {
                return;
            }
            var values = {};
            for (var key in _this.updatedValues) {
                values[key] = _this.updatedValues[key];
            }
            _this.send('visitor.update', {
                values: values
            });
            _this.updatedValues = {};
        }, 1);
    };
    WebsocketVisitorClient.prototype.checkServerVersion = function() {
        if (this.serverVersion === null) {
            throw new Error('Client not yet connected to server');
        }
    };
    WebsocketVisitorClient.CLIENT_VERSION = 6;
    WebsocketVisitorClient.identityProperties = [
        'id', 'name', 'email', 'phone', 'chatId', 'variables', 'lang', 'group', 'bannedAt', 'triggerable', 'visits', 'gdprApproved',
    ];
    return WebsocketVisitorClient;
}(websocket_client_core_1.default));
exports.WebsocketVisitorClient = WebsocketVisitorClient;
(function(WebsocketVisitorClient) {
    var EventName;
    (function(EventName) {
        EventName["WidgetOpen"] = "widget_open";
        EventName["WidgetShow"] = "widget_show";
        EventName["VisitorActive"] = "visitor_active";
        EventName["VisitorInactive"] = "visitor_inactive";
    })(EventName = WebsocketVisitorClient.EventName || (WebsocketVisitorClient.EventName = {}));
})(WebsocketVisitorClient = exports.WebsocketVisitorClient || (exports.WebsocketVisitorClient = {}));
exports.WebsocketVisitorClient = WebsocketVisitorClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLDJGQUE4RDtBQUU5RCw0RUFBd0g7QUFJeEg7SUFBNEMsMENBQXFEO0lBWWhHLGdDQUFZLE9BQXVDO1FBQW5ELFlBQ0Msa0JBQU0sT0FBTyxDQUFDLFVBQVUsQ0FBQyxTQUd6QjtRQVZELG1CQUFhLEdBQVcsSUFBSSxDQUFBO1FBSXBCLG1CQUFhLEdBQVEsRUFBRSxDQUFBO1FBSTlCLEtBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQTtRQUMvQixLQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQSxDQUFDLDRDQUE0Qzs7SUFDbEUsQ0FBQztJQUVTLDhDQUFhLEdBQXZCLFVBQXdCLFVBQVU7UUFDakMsaUJBQU0sYUFBYSxZQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQy9CLFVBQVUsQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLElBQUEsOEJBQUssRUFBQyxJQUFJLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQTtRQUMzRCxVQUFVLENBQUMsRUFBRSxDQUFDLGlCQUFpQixFQUFFLElBQUEsc0NBQWEsRUFBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGlCQUFpQixDQUFDLENBQUMsQ0FBQTtRQUNoRixVQUFVLENBQUMsRUFBRSxDQUFDLGVBQWUsRUFBRSxJQUFBLHNDQUFhLEVBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFBO1FBQzVFLFVBQVUsQ0FBQyxFQUFFLENBQUMsc0JBQXNCLEVBQUUsSUFBQSxzQ0FBYSxFQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxDQUFBO1FBQzFGLFVBQVUsQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFF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